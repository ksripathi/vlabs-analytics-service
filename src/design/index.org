#+TITLE: Design of Analytics API Service
#+AUTHOR: VLEAD
#+DATE: [2016-09-09 Fri]
#+SETUPFILE: ../org-templates/level-1.org
#+TAGS: boilerplate(b)
#+EXCLUDE_TAGS: boilerplate
#+OPTIONS: ^:nil


* Introduction 
  The =design= of the =Analytics Service= is captured here.

* Architecture diagram
  Refer the diagram given below - 
  [[https://github.com/openedx-vlead/port-labs-to-openedx/blob/develop/src/analytics-setup/presentations/sprint2/images/VLABS%20Open%20edx%20Architecture%20Diagram.jpg][VLABS architecture diagram]]

  OpenedX server ---- POST ---->> Analytics API ---- POST ---->> Elasticsearch
  
* Flow 
    + As per the design, students will visit VLABS OpenedX and will
    access a Lab. When a student clicks an experiment section to
    perform an experiment, data related to the experiment (Experiment
    name, Experiment ID, Lab name, Lab ID, User ID) is POSTed to
    Analytics API server.
  + Analytics API server further evaluates the IP address of the
    client and obtains (GET) the location of the IP address using
    http://freegeoip.net/json/<your-ip-address>.
  + Analytics API server then POST the data to Elasticsearch in JSON
    format.
  + Kibana using its visualization then represents the graphs
    obtained.
  + Information on implementation of ELK node can be [[https://github.com/openedx-vlead/elk-stack-for-analytics][read here]]

   [[./analytics-design-for-vlabs-openedx.jpg]]
* Application Programming Interface
  :PROPERTIES:
  :CUSTOM_ID: api
  :END: 
** Post Data to Analytics Server 
  :PROPERTIES:
  :CUSTOM_ID: analytics_server_post_data
  :END:    
  - URL :: /

  - Method :: POST

  - URL Params
    Required: Student_ID["string"], Lab_ID["string"], Lab_name["string"], Experiment_ID["string"], Experiment_name["string"], 

  - Success Response
    + Code: 200/201
  
** Get Records count from Elasticsearch server
  :PROPERTIES:
  :CUSTOM_ID: get_elasticseacrch_server_count
  :END:    
  - URL :: /api//elkusage

  - Method :: GET

  - URL Params
    None

  - Success Response
    + Code: 200


** Get total usage  count from Elasticsearch server and stats server
  :PROPERTIES:
  :CUSTOM_ID: total_usage-count
  :END:
  - URL :: /api/totalusage

  - Method :: GET

  - URL Params
    None

  - Success Response
    + Code: 200

